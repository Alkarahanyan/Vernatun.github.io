<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í–µ—Ä–Ω–∞—Ç—É–Ω: –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –í—Å—Ç—Ä–µ—á</title>
    <style>
        :root {
            --bg: #121212;
            --panel: #1E1E1E;
            --border: #333;
            --primary: #FF9F1C; /* Orange */
            --secondary: #2EC4B6; /* Blue */
            --accent: #E71D36; /* Red */
            --text: #F5F5F5;
            --text-muted: #A0A0A0;
            --card-hover: #2a2a2a;
            --tab-active-bg: #2D2D2D;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        body { background-color: var(--bg); color: var(--text); height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        /* HEADER */
        header {
            height: 70px;
            background: var(--panel);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
        }
        
        .brand { display: flex; align-items: center; gap: 15px; }
        .logo-box { 
            width: 40px; height: 40px; background: var(--primary); color: #000; 
            border-radius: 8px; display: flex; align-items: center; justify-content: center; 
            font-size: 1.5rem; font-weight: bold; 
        }
        h1 { font-size: 1.2rem; color: var(--text); text-transform: uppercase; letter-spacing: 1px; line-height: 1.2; }
        h1 span { color: var(--primary); font-size: 0.8em; display: block; }

        .controls { display: flex; gap: 20px; align-items: center; }
        
        /* TABS */
        .tabs { display: flex; background: #000; border-radius: 8px; padding: 4px; gap: 5px; }
        .tab-btn {
            background: none; border: none; color: var(--text-muted); 
            padding: 8px 20px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.9rem;
            transition: 0.2s;
        }
        .tab-btn:hover { color: var(--text); }
        .tab-btn.active { background: var(--tab-active-bg); color: var(--primary); box-shadow: 0 2px 4px rgba(0,0,0,0.2); }

        /* Toggle Switch */
        .switch-container { display: flex; align-items: center; gap: 10px; font-size: 0.9rem; border-left: 1px solid #444; padding-left: 20px; }
        .switch { position: relative; display: inline-block; width: 44px; height: 22px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #444; transition: .4s; border-radius: 24px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--secondary); }
        input:checked + .slider:before { transform: translateX(22px); }

        button.btn-reset {
            background: none; border: 1px solid #555; color: #888;
            padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 0.8rem;
        }
        button.btn-reset:hover { border-color: var(--accent); color: var(--accent); }

        /* MAIN LAYOUT */
        .main-container { display: flex; height: calc(100vh - 70px); }

        /* LIBRARY (LEFT) */
        .library {
            width: 320px;
            background: var(--panel);
            border-right: 1px solid var(--border);
            overflow-y: auto;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            transition: width 0.3s;
            flex-shrink: 0;
        }
        .library.hidden { width: 0; padding: 0; border: none; }
        .lib-header { color: var(--text-muted); font-size: 0.75rem; font-weight: 700; text-transform: uppercase; margin-top: 15px; margin-bottom: 5px; letter-spacing: 0.5px; }
        
        /* Draggable Card */
        .activity-card {
            background: #2D2D2D;
            padding: 12px;
            border-radius: 6px;
            border-left: 4px solid var(--secondary);
            cursor: grab;
            font-size: 0.9rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: transform 0.2s, background 0.2s;
            user-select: none;
            position: relative;
        }
        .activity-card:hover { transform: translateY(-2px); background: #353535; }
        .activity-card:active { cursor: grabbing; }
        .activity-card h4 { margin-bottom: 4px; pointer-events: none; color: #fff; font-size: 0.95rem; }
        .activity-card .tag { font-size: 0.7rem; color: var(--text-muted); pointer-events: none; display: inline-block; background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px; }
        .activity-card .preview-text { font-size: 0.75rem; color: #888; margin-top: 4px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; pointer-events: none; }
        
        /* TIMETABLE (RIGHT) */
        .timetable { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 2px; background: #161616; }
        
        .grid-header {
            display: grid;
            grid-template-columns: 70px 1fr 1fr 1fr;
            gap: 10px;
            text-align: center;
            font-weight: bold;
            color: var(--secondary);
            margin-bottom: 10px;
            position: sticky;
            top: 0;
            background: #161616;
            z-index: 10;
            padding-bottom: 5px;
        }
        .col-header { background: #252525; padding: 10px; border-radius: 6px; border-bottom: 2px solid #333; }
        
        /* Time Row */
        .time-row {
            display: grid;
            grid-template-columns: 70px 1fr 1fr 1fr;
            gap: 10px;
            min-height: 110px;
            border-top: 1px solid #222;
            padding-top: 10px;
            padding-bottom: 10px;
        }
        
        .time-label {
            display: flex; align-items: flex-start; justify-content: center; padding-top: 10px;
            color: var(--text-muted); font-weight: bold; font-family: monospace; font-size: 1.1rem;
        }

        .drop-zone {
            background: #1a1a1a;
            border: 2px dashed #333;
            border-radius: 8px;
            padding: 8px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            transition: background 0.2s, border-color 0.2s;
            position: relative;
        }
        .drop-zone.drag-over { background: #252525; border-color: var(--primary); }
        
        /* Parallel Zone Styling */
        .zone-common { border-color: #444; }
        .zone-a { background: rgba(46, 196, 182, 0.03); border-color: rgba(46, 196, 182, 0.15); }
        .zone-b { background: rgba(255, 159, 28, 0.03); border-color: rgba(255, 159, 28, 0.15); }

        /* Card inside Dropzone */
        .drop-zone .activity-card {
            margin: 0;
            border-left-width: 4px;
        }
        .delete-btn {
            position: absolute; top: 4px; right: 4px;
            color: #ff5555; cursor: pointer; display: none; font-size: 14px;
            background: rgba(0,0,0,0.6); border-radius: 50%; width: 20px; height: 20px;
            align-items: center; justify-content: center; z-index: 5;
        }
        .drop-zone .activity-card:hover .delete-btn { display: flex; }

        /* MODAL */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            display: none; justify-content: center; align-items: center;
            z-index: 1000;
            backdrop-filter: blur(3px);
        }
        .modal {
            background: var(--panel);
            width: 600px;
            max-width: 90%;
            padding: 30px;
            border-radius: 12px;
            border: 1px solid #444;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            animation: modalFadeIn 0.2s ease-out;
        }
        @keyframes modalFadeIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .modal h2 { color: var(--primary); margin-bottom: 5px; font-size: 1.5rem; }
        .modal .meta { font-size: 0.9rem; color: var(--text-muted); margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 15px; display: flex; gap: 10px; }
        .modal .meta span { background: #333; padding: 2px 8px; border-radius: 4px; color: #fff; }
        .modal p { line-height: 1.7; margin-bottom: 15px; font-size: 1.05rem; white-space: pre-wrap; }
        .close-modal {
            background: var(--primary); color: #000; border: none;
            padding: 10px 25px; border-radius: 6px; cursor: pointer; font-weight: bold; float: right; font-size: 1rem;
        }
        .close-modal:hover { background: #ffaf46; }

        /* Read Only Mode Styles */
        body.read-only .library { display: none; }
        body.read-only .delete-btn { display: none !important; }
        body.read-only .drop-zone { border-style: solid; border-color: #222; }
        
    </style>
</head>
<body>

<header>
    <div class="brand">
        <div class="logo-box">üèõÔ∏è</div>
        <h1>–í–µ—Ä–Ω–∞—Ç—É–Ω<br><span>–ê—Ä–º—è–Ω—Å–∫–∏–π –∫–ª—É–±</span></h1>
    </div>

    <!-- TABS -->
    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('tue')" id="btn-tue">–í—Ç–æ—Ä–Ω–∏–∫ (Talk)</button>
        <button class="tab-btn" onclick="switchTab('sat')" id="btn-sat">–°—É–±–±–æ—Ç–∞ (Chill)</button>
    </div>

    <div class="controls">
        <button class="btn-reset" onclick="clearSchedule()">–û—á–∏—Å—Ç–∏—Ç—å</button>
        <div class="switch-container">
            <span>–ü—Ä–æ—Å–º–æ—Ç—Ä</span>
            <label class="switch">
                <input type="checkbox" id="adminToggle" checked onchange="toggleMode()">
                <span class="slider"></span>
            </label>
            <span>–†–µ–¥–∞–∫—Ç–æ—Ä</span>
        </div>
    </div>
</header>

<div class="main-container">
    <!-- LIBRARY (Draggable Items) -->
    <div class="library" id="library">
        <!-- Items will be injected by JS -->
    </div>

    <!-- TIMETABLE -->
    <div class="timetable" id="timetable">
        <div class="grid-header">
            <div>–í—Ä–µ–º—è</div>
            <div class="col-header">–û–±—â–∏–π –ó–∞–ª<br><span style="font-size:0.75rem; color:#888; font-weight:normal">–†–∞–∑–º–∏–Ω–∫–∞ / –§–∏–Ω–∞–ª</span></div>
            <div class="col-header" style="border-bottom-color: var(--secondary)">Level A<br><span style="font-size:0.75rem; color:#888; font-weight:normal">–ù–æ–≤–∏—á–∫–∏ / –ë–∞–∑–∞</span></div>
            <div class="col-header" style="border-bottom-color: var(--primary)">Level B<br><span style="font-size:0.75rem; color:#888; font-weight:normal">–ü—Ä–æ—Ñ–∏ / –ù–æ—Å–∏—Ç–µ–ª–∏</span></div>
        </div>
        
        <!-- Rows Generated by JS -->
    </div>
</div>

<!-- INFO MODAL -->
<div class="modal-overlay" id="modal">
    <div class="modal">
        <h2 id="m-title">–ù–∞–∑–≤–∞–Ω–∏–µ</h2>
        <div class="meta" id="m-meta"></div>
        <p id="m-desc">–û–ø–∏—Å–∞–Ω–∏–µ...</p>
        <button class="close-modal" onclick="closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
</div>

<script>
    // --- 1. STATE & DATA ---
    let currentTab = 'tue'; // 'tue' or 'sat'

    const activities = [
        // Warmup (–†–∞–∑–æ–≥—Ä–µ–≤)
        { 
            id: 'ice1', title: 'Speed Dating', type: 'Warmup', color: '#ff7675', 
            desc: '–î–∏–Ω–∞–º–∏—á–Ω–æ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –Ω–∞ —Å–Ω—è—Ç–∏–µ –±–∞—Ä—å–µ—Ä–æ–≤.\n\n–ú–µ—Ö–∞–Ω–∏–∫–∞:\n–£—á–∞—Å—Ç–Ω–∏–∫–∏ –æ–±—Ä–∞–∑—É—é—Ç –¥–≤–∞ –∫—Ä—É–≥–∞ (–≤–Ω–µ—à–Ω–∏–π –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π). –ö–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã –≤–Ω–µ—à–Ω–∏–π –∫—Ä—É–≥ —Å–¥–≤–∏–≥–∞–µ—Ç—Å—è –Ω–∞ –æ–¥–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞. –ù–∞ –ø—Ä–æ–µ–∫—Ç–æ—Ä –≤—ã–≤–æ–¥—è—Ç—Å—è –≤–æ–ø—Ä–æ—Å—ã –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä: "–¢–≤–æ–π –ª—é–±–∏–º—ã–π —Ä–∞–π–æ–Ω –ï—Ä–µ–≤–∞–Ω–∞ –∏ –ø–æ—á–µ–º—É?", "–ö–∞–∫–æ–µ –∞—Ä–º—è–Ω—Å–∫–æ–µ –±–ª—é–¥–æ —Ç—ã –≥–æ—Ç–æ–≤–∏–ª –ø–æ—Å–ª–µ–¥–Ω–∏–º?".\n\n–¶–µ–ª—å: –ë—ã—Å—Ç—Ä–æ —Ä–∞–∑–≥–æ–≤–æ—Ä–∏—Ç—å –≥—Ä—É–ø–ø—É –∏ –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å –≤—Å–µ—Ö.' 
        },
        { 
            id: 'ice2', title: '–î–≤–µ –ø—Ä–∞–≤–¥—ã, –æ–¥–Ω–∞ –ª–æ–∂—å', type: 'Warmup', color: '#ff7675', 
            desc: '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –∏–≥—Ä–∞ –Ω–∞ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–æ.\n\n–ú–µ—Ö–∞–Ω–∏–∫–∞:\n–ö–∞–∂–¥—ã–π —É—á–∞—Å—Ç–Ω–∏–∫ –ø–∏—à–µ—Ç –Ω–∞ –ª–∏—Å—Ç–æ—á–∫–µ 3 —Ñ–∞–∫—Ç–∞ –æ —Å–µ–±–µ (2 –ø—Ä–∞–≤–¥–∏–≤—ã—Ö, 1 –≤—ã–º—ã—à–ª–µ–Ω–Ω—ã–π). –û—Å—Ç–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞—é—Ç –Ω–∞–≤–æ–¥—è—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã –Ω–∞ –∞—Ä–º—è–Ω—Å–∫–æ–º (—Ç–æ–ª—å–∫–æ Yes/No questions), –ø—ã—Ç–∞—è—Å—å —Ä–∞—Å–∫—Ä—ã—Ç—å –ª–æ–∂—å.\n\n–õ–µ–∫—Å–∏–∫–∞: –í–æ–ø—Ä–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, –≥–ª–∞–≥–æ–ª—ã –¥–µ–π—Å—Ç–≤–∏—è.' 
        },
        { 
            id: 'ice3', title: 'Human Bingo', type: 'Warmup', color: '#ff7675', 
            desc: '–ê–∫—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –ª—é–¥–µ–π –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º.\n\n–ú–µ—Ö–∞–Ω–∏–∫–∞:\n–ö–∞–∂–¥—ã–π –ø–æ–ª—É—á–∞–µ—Ç –∫–∞—Ä—Ç–æ—á–∫—É —Å —Å–µ—Ç–∫–æ–π 4x4. –í –∫–ª–µ—Ç–∫–∞—Ö –Ω–∞–ø–∏—Å–∞–Ω—ã —Ñ–∞–∫—Ç—ã: "–£–º–µ–µ—Ç –∏–≥—Ä–∞—Ç—å –Ω–∞ –¥—É–¥—É–∫–µ", "–ë—ã–ª –≤ –ì—é–º—Ä–∏", "–õ—é–±–∏—Ç –∫–∏–Ω–∑—É". –ó–∞–¥–∞—á–∞: —Ö–æ–¥–∏—Ç—å –ø–æ –∑–∞–ª—É, –æ–ø—Ä–∞—à–∏–≤–∞—Ç—å –ª—é–¥–µ–π –Ω–∞ –∞—Ä–º—è–Ω—Å–∫–æ–º –∏ –≤–ø–∏—Å—ã–≤–∞—Ç—å –∏–º–µ–Ω–∞ —Ç–µ—Ö, –∫—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—é.\n\n–¶–µ–ª—å: –°–æ–±—Ä–∞—Ç—å –ª–∏–Ω–∏—é (Bingo) –ø–µ—Ä–≤—ã–º.' 
        },
        { 
            id: 'ice4', title: '–°–Ω–µ–∂–Ω—ã–π –∫–æ–º –∏–º–µ–Ω', type: 'Warmup', color: '#ff7675', 
            desc: '–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –ø–∞–º—è—Ç–∏ –∏ –∏–º–µ–Ω.\n\n–ú–µ—Ö–∞–Ω–∏–∫–∞:\n–ü–µ—Ä–≤—ã–π –≥–æ–≤–æ—Ä–∏—Ç: "–Ø –ê—Ä–º–µ–Ω, –ª—é–±–ª—é –∞–±—Ä–∏–∫–æ—Å—ã". –í—Ç–æ—Ä–æ–π: "–≠—Ç–æ –ê—Ä–º–µ–Ω, –æ–Ω –ª—é–±–∏—Ç –∞–±—Ä–∏–∫–æ—Å—ã, –∞ —è –ê–Ω–∏, –ª—é–±–ª—é –ê—Ä–∞—Ä–∞—Ç". –¢—Ä–µ—Ç–∏–π –¥–æ–ª–∂–µ–Ω –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –¥–≤–æ–∏—Ö –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –∏ –¥–æ–±–∞–≤–∏—Ç—å —Å–µ–±—è.\n\n–°–æ–≤–µ—Ç: –î–æ–±–∞–≤–ª—è—Ç—å –ø—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã–µ –Ω–∞ —Ç—É –∂–µ –±—É–∫–≤—É, —á—Ç–æ –∏ –∏–º—è.' 
        },

        // Speaking Active
        { 
            id: 'sp1', title: '–†–æ–ª–µ–≤–∞—è: –†–∞–∑–≥–æ–≤–æ—Ä—á–∏–≤—ã–π —Ç–∞–∫—Å–∏—Å—Ç', type: 'Speaking', color: '#74b9ff', 
            desc: '–°–∏–º—É–ª—è—Ü–∏—è –∂–∏–∑–Ω–µ–Ω–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏.\n\n–†–æ–ª–∏:\n1. –¢–∞–∫—Å–∏—Å—Ç (–¥–æ–ª–∂–µ–Ω —É–∑–Ω–∞—Ç—å –æ –ø–∞—Å—Å–∞–∂–∏—Ä–µ –≤—Å—ë: –∂–µ–Ω–∞—Ç/–∑–∞–º—É–∂–µ–º, –≥–¥–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, —Å–∫–æ–ª—å–∫–æ –ø–æ–ª—É—á–∞–µ—Ç).\n2. –ü–∞—Å—Å–∞–∂–∏—Ä (—Å–ø–µ—à–∏—Ç, –æ—Ç–≤–µ—á–∞–µ—Ç –∫–æ—Ä–æ—Ç–∫–æ, –Ω–æ –≤–µ–∂–ª–∏–≤–æ).\n\n–ó–∞–¥–∞—á–∞: –¢–∞–∫—Å–∏—Å—Ç –¥–æ–ª–∂–µ–Ω —Å–æ—Å—Ç–∞–≤–∏—Ç—å –¥–æ—Å—å–µ –Ω–∞ –ø–∞—Å—Å–∞–∂–∏—Ä–∞ –∑–∞ 5 –º–∏–Ω—É—Ç –ø–æ–µ–∑–¥–∫–∏.' 
        },
        { 
            id: 'sp2', title: '–†–æ–ª–µ–≤–∞—è: –¢–æ—Ä–≥ –Ω–∞ –í–µ—Ä–Ω–∏—Å–∞–∂–µ', type: 'Speaking', color: '#74b9ff', 
            desc: '–ü—Ä–∞–∫—Ç–∏–∫–∞ —á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –∏ —É–±–µ–∂–¥–µ–Ω–∏—è.\n\n–†–æ–ª–∏:\n1. –ü—Ä–æ–¥–∞–≤–µ—Ü —Å—É–≤–µ–Ω–∏—Ä–æ–≤ (–∑–∞–≤—ã—à–∞–µ—Ç —Ü–µ–Ω—É –≤ 3 —Ä–∞–∑–∞).\n2. –¢—É—Ä–∏—Å—Ç (—Ö–æ—á–µ—Ç –∫—É–ø–∏—Ç—å –¥–µ—à–µ–≤–ª–µ).\n\n–ó–∞–¥–∞—á–∞: –î–æ–≥–æ–≤–æ—Ä–∏—Ç—å—Å—è –æ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Ü–µ–Ω–µ. –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ñ—Ä–∞–∑—ã: "Tang e" (–î–æ—Ä–æ–≥–æ), "Ijecreq gine" (–°–∫–∏–Ω—å—Ç–µ —Ü–µ–Ω—É).' 
        },
        { 
            id: 'sp3', title: '–®—É—Ç–æ—á–Ω—ã–µ –î–µ–±–∞—Ç—ã', type: 'Speaking', color: '#74b9ff', 
            desc: '–ê—Ä–≥—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ –≤–µ—Å–µ–ª–æ–º —Ñ–æ—Ä–º–∞—Ç–µ.\n\n–¢–µ–º—ã:\n- –õ–∞–≤–∞—à –ª—É—á—à–µ –º–∞—Ç–Ω–∞–∫–∞—à–∞?\n- –î–æ–ª–º–∞ —Å –≤–∏–Ω–æ–≥—Ä–∞–¥–Ω—ã–º–∏ –ª–∏—Å—Ç—å—è–º–∏ –∏–ª–∏ –∫–∞–ø—É—Å—Ç–æ–π?\n- –ñ–∏—Ç—å —Å —Ä–æ–¥–∏—Ç–µ–ª—è–º–∏: –∑–∞ –∏ –ø—Ä–æ—Ç–∏–≤.\n\n–ú–µ—Ö–∞–Ω–∏–∫–∞: –ì—Ä—É–ø–ø–∞ –¥–µ–ª–∏—Ç—Å—è –Ω–∞ –∫–æ–º–∞–Ω–¥—ã. –î–∞–µ—Ç—Å—è 5 –º–∏–Ω—É—Ç –Ω–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤. –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä —Å–ª–µ–¥–∏—Ç –∑–∞ —Ç–∞–π–º–∏–Ω–≥–æ–º.' 
        },
        { 
            id: 'sp4', title: 'Alibi (–î–µ—Ç–µ–∫—Ç–∏–≤)', type: 'Speaking', color: '#74b9ff', 
            desc: '–ò–≥—Ä–∞ –Ω–∞ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫ –¥–µ—Ç–∞–ª—è–º.\n\n–ú–µ—Ö–∞–Ω–∏–∫–∞:\n–î–≤–æ–µ "–ø–æ–¥–æ–∑—Ä–µ–≤–∞–µ–º—ã—Ö" –≤—ã—Ö–æ–¥—è—Ç –∏–∑ –∫–æ–º–Ω–∞—Ç—ã –∏ –ø—Ä–∏–¥—É–º—ã–≤–∞—é—Ç –∞–ª–∏–±–∏ (—á—Ç–æ –æ–Ω–∏ –¥–µ–ª–∞–ª–∏ –≤—á–µ—Ä–∞ —Å 18:00 –¥–æ 20:00). –ì—Ä—É–ø–ø–∞ "—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª–µ–π" –¥–æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç –∏—Ö –ü–û –û–¢–î–ï–õ–¨–ù–û–°–¢–ò. –õ—é–±–æ–µ –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –≤ –ø–æ–∫–∞–∑–∞–Ω–∏—è—Ö –æ–∑–Ω–∞—á–∞–µ—Ç –ø—Ä–æ–∏–≥—Ä—ã—à.\n\n–í–æ–ø—Ä–æ—Å—ã: –í–æ —á—Ç–æ –±—ã–ª –æ–¥–µ—Ç? –ß—Ç–æ –∑–∞–∫–∞–∑—ã–≤–∞–ª–∏? –ö—Ç–æ –ø–ª–∞—Ç–∏–ª?' 
        },
        { 
            id: 'sp5', title: '–ò–Ω—Ç–µ—Ä–≤—å—é —Å–æ –∑–≤–µ–∑–¥–æ–π', type: 'Speaking', color: '#74b9ff', 
            desc: '–û–¥–∏–Ω —É—á–∞—Å—Ç–Ω–∏–∫ –≤–∂–∏–≤–∞–µ—Ç—Å—è –≤ —Ä–æ–ª—å –∑–Ω–∞–º–µ–Ω–∏—Ç–æ—Å—Ç–∏ (–®–µ—Ä, –ê–∑–Ω–∞–≤—É—Ä, –ö–∏–º, –ü–∞—à–∏–Ω—è–Ω). –û—Å—Ç–∞–ª—å–Ω—ã–µ - –∂—É—Ä–Ω–∞–ª–∏—Å—Ç—ã –Ω–∞ –ø—Ä–µ—Å—Å-–∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏.\n\n–¶–µ–ª—å: –ó–∞–¥–∞–≤–∞—Ç—å –∫–∞–≤–µ—Ä–∑–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã.' 
        },

        // Games
        { 
            id: 'gm1', title: 'Mafia (Armenian)', type: 'Game', color: '#a29bfe', 
            desc: '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∞—è –∏–≥—Ä–∞, –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ–¥ –∫–ª—É–±.\n\n–ü—Ä–∞–≤–∏–ª–æ ‚Ññ1: –ù–ò –°–õ–û–í–ê –ü–û-–†–£–°–°–ö–ò. –®—Ç—Ä–∞—Ñ - –≤—ã–ª–µ—Ç –∏–∑ –∏–≥—Ä—ã.\n\n–§—Ä–∞–∑—ã:\n- "Es kaskatsum em..." (–Ø –ø–æ–¥–æ–∑—Ä–µ–≤–∞—é)\n- "Na stum e" (–û–Ω/–æ–Ω–∞ –≤—Ä–µ—Ç)\n- "Qaxaqe qnac e" (–ì–æ—Ä–æ–¥ —Å–ø–∏—Ç)\n\n–†–∞–∑–≤–∏–≤–∞–µ—Ç –Ω–∞–≤—ã–∫–∏ —É–±–µ–∂–¥–µ–Ω–∏—è –∏ –æ–ø—Ä–∞–≤–¥–∞–Ω–∏—è.' 
        },
        { 
            id: 'gm2', title: 'Alias / Taboo', type: 'Game', color: '#a29bfe', 
            desc: '–û–±—ä—è—Å–Ω–µ–Ω–∏–µ —Å–ª–æ–≤ –Ω–∞ –≤—Ä–µ–º—è.\n\n–ú–µ—Ö–∞–Ω–∏–∫–∞:\n–ò–≥—Ä–æ–∫ –±–µ—Ä–µ—Ç –∫–∞—Ä—Ç–æ—á–∫—É –∏ –¥–æ–ª–∂–µ–Ω –æ–±—ä—è—Å–Ω–∏—Ç—å —Å–ª–æ–≤–æ, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—è –æ–¥–Ω–æ–∫–æ—Ä–µ–Ω–Ω—ã–µ. –ù–∞–ø—Ä–∏–º–µ—Ä, –æ–±—ä—è—Å–Ω–∏—Ç—å —Å–ª–æ–≤–æ "–°–µ–≤–∞–Ω", –Ω–µ –≥–æ–≤–æ—Ä—è "–û–∑–µ—Ä–æ", "–í–æ–¥–∞", "–†—ã–±–∞".\n\n–î–∏–Ω–∞–º–∏—á–Ω–æ, –≤–µ—Å–µ–ª–æ, —Ä–∞—Å—à–∏—Ä—è–µ—Ç —Å–ª–æ–≤–∞—Ä–Ω—ã–π –∑–∞–ø–∞—Å.' 
        },
        { 
            id: 'gm3', title: 'Just a Minute', type: 'Game', color: '#a29bfe', 
            desc: '–û—Ä–∞—Ç–æ—Ä—Å–∫–æ–µ –∏—Å–∫—É—Å—Å—Ç–≤–æ.\n\n–ó–∞–¥–∞—á–∞:\n–ì–æ–≤–æ—Ä–∏—Ç—å –Ω–∞ –≤—ã–ø–∞–≤—à—É—é —Ç–µ–º—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ê–±—Ä–∏–∫–æ—Å", "–ú–µ—Ç—Ä–æ", "–°–≤–∞–¥—å–±–∞") —Ä–æ–≤–Ω–æ 1 –º–∏–Ω—É—Ç—É. –ù–µ–ª—å–∑—è: –¥–µ–ª–∞—Ç—å –ø–∞—É–∑—ã –±–æ–ª—å—à–µ 3 —Å–µ–∫, –ø–æ–≤—Ç–æ—Ä—è—Ç—å —Å–ª–æ–≤–∞, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª–æ–≤–∞-–ø–∞—Ä–∞–∑–∏—Ç—ã.' 
        },
        { 
            id: 'gm4', title: '–ö—Ä–æ–∫–æ–¥–∏–ª (–ü–∞–Ω—Ç–æ–º–∏–º–∞)', type: 'Game', color: '#a29bfe', 
            desc: '–ü–æ–∫–∞–∑–∞—Ç—å —Å–ª–æ–≤–æ –∏–ª–∏ –ø–æ—Å–ª–æ–≤–∏—Ü—É –∂–µ—Å—Ç–∞–º–∏. –ì—Ä—É–ø–ø–∞ –¥–æ–ª–∂–Ω–∞ —É–≥–∞–¥–∞—Ç—å –∏ –Ω–∞–∑–≤–∞—Ç—å —ç—Ç–æ –Ω–∞ –∞—Ä–º—è–Ω—Å–∫–æ–º.' 
        },

        // Media
        { 
            id: 'med1', title: '–ö–∏–Ω–æ-–æ–∑–≤—É—á–∫–∞', type: 'Media', color: '#fdcb6e', 
            desc: '–¢–≤–æ—Ä—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ.\n\n–ú–µ—Ö–∞–Ω–∏–∫–∞:\n–ë–µ—Ä–µ–º —Å—Ü–µ–Ω—É –∏–∑ "–ú—É–∂—á–∏–Ω—ã" (Tghamardik) –∏–ª–∏ "–ú–∏–º–∏–Ω–æ". –°–º–æ—Ç—Ä–∏–º –æ—Ä–∏–≥–∏–Ω–∞–ª. –í—ã–∫–ª—é—á–∞–µ–º –∑–≤—É–∫. –£—á–∞—Å—Ç–Ω–∏–∫–∏ –ø–æ–ª—É—á–∞—é—Ç —Ç–µ–∫—Å—Ç –∏–ª–∏ –∏–º–ø—Ä–æ–≤–∏–∑–∏—Ä—É—é—Ç, –æ–∑–≤—É—á–∏–≤–∞—è –≥–µ—Ä–æ–µ–≤ –≤ –º–∏–∫—Ä–æ—Ñ–æ–Ω. –ú–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –∂–∞–Ω—Ä (–ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –¥—Ä–∞–º—É –≤ –∫–æ–º–µ–¥–∏—é).' 
        },
        { 
            id: 'med2', title: '–†–∞–∑–±–æ—Ä –ö–ª–∏–ø–∞', type: 'Media', color: '#fdcb6e', 
            desc: '–†–∞–±–æ—Ç–∞ —Å —Ç–µ–∫—Å—Ç–æ–º –ø–µ—Å–Ω–∏.\n\n–ú–∞—Ç–µ—Ä–∏–∞–ª: Malena, Sirusho, Aram MP3.\n1. –°–ª—É—à–∞–µ–º.\n2. –ß–∏—Ç–∞–µ–º —Ç–µ–∫—Å—Ç, —Ä–∞–∑–±–∏—Ä–∞–µ–º —Å–ª–µ–Ω–≥.\n3. –ü–æ–µ–º –ø—Ä–∏–ø–µ–≤ —Ö–æ—Ä–æ–º.' 
        },
        { 
            id: 'med3', title: '–ö–∏–Ω–æ-–ö–≤–∏–∑', type: 'Media', color: '#fdcb6e', 
            desc: '–í–∏–∫—Ç–æ—Ä–∏–Ω–∞ –ø–æ –∞—Ä–º—è–Ω—Å–∫–æ–º—É –∫–∏–Ω–æ.\n–†–∞—É–Ω–¥—ã:\n- –£–≥–∞–¥–∞–π —Ñ–∏–ª—å–º –ø–æ –∫–∞–¥—Ä—É.\n- –ü—Ä–æ–¥–æ–ª–∂–∏ —Ü–∏—Ç–∞—Ç—É.\n- –ü—Ä–∞–≤–¥–∞ –∏–ª–∏ –ª–æ–∂—å –æ–± –∞–∫—Ç–µ—Ä–µ.' 
        },

        // Level A (Beginners)
        { 
            id: 'beg1', title: '–ê–ª—Ñ–∞–≤–∏—Ç-–ê—Å—Å–æ—Ü–∏–∞—Ü–∏–∏', type: 'Level A', color: '#55efc4', 
            desc: '–î–ª—è —Ç–µ—Ö, –∫—Ç–æ –Ω–µ —É–º–µ–µ—Ç —á–∏—Ç–∞—Ç—å.\n\n–ú–µ—Ç–æ–¥:\n–ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±—É–∫–≤—É –∏ –∫–∞—Ä—Ç–∏–Ω–∫—É, –Ω–∞ —á—Ç–æ –æ–Ω–∞ –ø–æ—Ö–æ–∂–∞ (–® - –ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç–∞—è –ú, ’å - –∫–∞–∫ R –Ω–∞ –Ω–æ–∂–∫–∞—Ö). –†–∏—Å—É–µ–º –±—É–∫–≤—ã.' 
        },
        { 
            id: 'beg2', title: '–ë–∞–∑–æ–≤—ã–µ —Ñ—Ä–∞–∑—ã (Drill)', type: 'Level A', color: '#55efc4', 
            desc: '–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ.\n\n–¢–µ–º—ã:\n- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ / –ü—Ä–æ—â–∞–Ω–∏–µ\n- –ö–∞–∫ –¥–µ–ª–∞?\n- –°—á–µ—Ç –¥–æ 100\n- –ó–∞–∫–∞–∑ –µ–¥—ã\n\n–†–∞–±–æ—Ç–∞–µ–º —Ö–æ—Ä–æ–º –∏ –ø–æ –ø–∞—Ä–∞–º.' 
        },
        { 
            id: 'beg3', title: '–ß—Ç–µ–Ω–∏–µ —Å–∫–∞–∑–∫–∏', type: 'Level A', color: '#55efc4', 
            desc: '–ú–µ–¥–ª–µ–Ω–Ω–æ–µ —á—Ç–µ–Ω–∏–µ.\n\n–ú–∞—Ç–µ—Ä–∏–∞–ª: –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–∫–∞–∑–∫–∏ –û–≤–∞–Ω–µ—Å–∞ –¢—É–º–∞–Ω—è–Ω–∞. –ß–∏—Ç–∞–µ–º –ø–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—é, –ø–µ—Ä–µ–≤–æ–¥–∏–º –∫–∞–∂–¥–æ–µ —Å–ª–æ–≤–æ.' 
        },

        // Level B (Advanced)
        { 
            id: 'adv1', title: '–ü–æ–ª–∏—Ç. –î–µ–±–∞—Ç—ã', type: 'Level B', color: '#fab1a0', 
            desc: '–î–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö –∏ –Ω–æ—Å–∏—Ç–µ–ª–µ–π.\n\n–û–±—Å—É–∂–¥–µ–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π –ê—Ä–º–µ–Ω–∏–∏ –∏ –º–∏—Ä–∞. –ó–∞–ø—Ä–µ—â–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏–º–∏—Ç–∏–≤–Ω—É—é –ª–µ–∫—Å–∏–∫—É. –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä –≤–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Å–ª–æ–∂–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å.' 
        },
        { 
            id: 'adv2', title: '–£–≥–∞–¥–∞–π –î–∏–∞–ª–µ–∫—Ç', type: 'Level B', color: '#fab1a0', 
            desc: '–ê—É–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–æ–∂–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è.\n\n–°–ª—É—à–∞–µ–º –∞—É–¥–∏–æ–∑–∞–ø–∏—Å–∏ —Ä–µ—á–∏ –∏–∑ –ì—é–º—Ä–∏, –ê—Ä—Ü–∞—Ö–∞, –ì–∞–≤–∞—Ä–∞, –õ–æ—Ä–∏. –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–Ω—è—Ç—å —Å–º—ã—Å–ª –∏ "–ø–µ—Ä–µ–≤–µ—Å—Ç–∏" –Ω–∞ –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω—ã–π –∞—Ä–º—è–Ω—Å–∫–∏–π.' 
        },
        { 
            id: 'adv3', title: '–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω—ã–π –∫–ª—É–±', type: 'Level B', color: '#fab1a0', 
            desc: '–ß—Ç–µ–Ω–∏–µ –ø–æ—ç–∑–∏–∏.\n\n–ê–≤—Ç–æ—Ä—ã: –ü–∞—Ä—É–π—Ä –°–µ–≤–∞–∫, –ï–≥–∏—à–µ –ß–∞—Ä–µ–Ω—Ü. –ê–Ω–∞–ª–∏–∑ –º–µ—Ç–∞—Ñ–æ—Ä –∏ –≥–ª—É–±–æ–∫–æ–≥–æ —Å–º—ã—Å–ª–∞.' 
        }
    ];

    // --- 2. INIT & RENDER ---
    const libraryEl = document.getElementById('library');
    const timetableEl = document.getElementById('timetable');
    
    // Fill Library
    function renderLibrary() {
        // Group by type helper
        const groups = {
            'Warmup': [], 'Speaking': [], 'Game': [], 'Media': [], 'Level A': [], 'Level B': []
        };
        
        activities.forEach(act => {
            if (groups[act.type]) groups[act.type].push(act);
        });

        const sectionOrder = ['Warmup', 'Speaking', 'Game', 'Media', 'Level A', 'Level B'];
        const sectionTitles = {
            'Warmup': 'üî• –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –Ω–∞ —Ä–∞–∑–æ–≥—Ä–µ–≤', 
            'Speaking': 'üó£Ô∏è –ê–∫—Ç–∏–≤–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞', 
            'Game': 'üé≤ –ò–≥—Ä—ã', 
            'Media': 'üé¨ –ú–µ–¥–∏–∞ / –ö–∏–Ω–æ', 
            'Level A': 'üå± –î–ª—è –ù–æ–≤–∏—á–∫–æ–≤ (A1)', 
            'Level B': 'ü¶Å –î–ª—è –ü—Ä–æ—Ñ–∏ (B2+)'
        };

        libraryEl.innerHTML = '<div style="font-size: 0.8rem; color: #888; margin-bottom: 10px; text-align: center;">–¢—è–Ω–∏ –∫–∞—Ä—Ç–æ—á–∫—É –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ ‚ûî</div>';

        sectionOrder.forEach(type => {
            if (groups[type].length > 0) {
                const header = document.createElement('div');
                header.className = 'lib-header';
                header.innerText = sectionTitles[type];
                libraryEl.appendChild(header);

                groups[type].forEach(act => {
                    const el = createCardElement(act);
                    libraryEl.appendChild(el);
                });
            }
        });
    }

    function createCardElement(act, inGrid = false) {
        const div = document.createElement('div');
        div.className = 'activity-card';
        div.draggable = true;
        div.dataset.id = act.id;
        div.style.borderLeftColor = act.color;
        
        // Preview text is only shown in library, not in grid to save space
        const preview = inGrid ? '' : `<div class="preview-text">${act.desc}</div>`;

        div.innerHTML = `
            <h4>${act.title}</h4>
            <div class="tag" style="background:${act.color}40; color:${act.color}">${act.type}</div>
            ${preview}
            <div class="delete-btn" onclick="removeCard(this, event)">√ó</div>
        `;
        
        // Drag Events
        div.addEventListener('dragstart', handleDragStart);
        div.addEventListener('click', () => showDetails(act.id));
        
        return div;
    }

    // Updated Time Slots
    const timeSlots = ['20:00', '20:30', '21:00', '21:30', '22:00', '22:30'];
    
    function renderGrid() {
        timetableEl.innerHTML = ''; // Clear existing
        
        // Re-add header
        timetableEl.innerHTML = `
        <div class="grid-header">
            <div>–í—Ä–µ–º—è</div>
            <div class="col-header">–û–±—â–∏–π –ó–∞–ª<br><span style="font-size:0.75rem; color:#888; font-weight:normal">–†–∞–∑–º–∏–Ω–∫–∞ / –§–∏–Ω–∞–ª</span></div>
            <div class="col-header" style="border-bottom-color: var(--secondary)">Level A<br><span style="font-size:0.75rem; color:#888; font-weight:normal">–ù–æ–≤–∏—á–∫–∏ / –ë–∞–∑–∞</span></div>
            <div class="col-header" style="border-bottom-color: var(--primary)">Level B<br><span style="font-size:0.75rem; color:#888; font-weight:normal">–ü—Ä–æ—Ñ–∏ / –ù–æ—Å–∏—Ç–µ–ª–∏</span></div>
        </div>`;

        timeSlots.forEach(time => {
            const row = document.createElement('div');
            row.className = 'time-row';
            
            // Time Label
            row.innerHTML = `<div class="time-label">${time}</div>`;
            
            // 3 Drop Zones
            const zones = ['common', 'level-a', 'level-b'];
            zones.forEach(zone => {
                const dropEl = document.createElement('div');
                dropEl.className = `drop-zone zone-${zone}`;
                dropEl.dataset.time = time;
                dropEl.dataset.zone = zone;
                
                // Drag Events
                dropEl.addEventListener('dragover', handleDragOver);
                dropEl.addEventListener('dragleave', handleDragLeave);
                dropEl.addEventListener('drop', handleDrop);
                
                row.appendChild(dropEl);
            });
            
            timetableEl.appendChild(row);
        });
        loadSchedule(); // Load saved data for current tab
    }

    // --- 3. DRAG & DROP LOGIC ---
    let draggedItem = null;

    function handleDragStart(e) {
        if (!document.getElementById('adminToggle').checked) {
            e.preventDefault();
            return;
        }
        draggedItem = this;
        e.dataTransfer.setData('text/plain', this.dataset.id);
        e.dataTransfer.effectAllowed = 'copy';
    }

    function handleDragOver(e) {
        if (!document.getElementById('adminToggle').checked) return;
        e.preventDefault();
        this.classList.add('drag-over');
    }

    function handleDragLeave(e) {
        this.classList.remove('drag-over');
    }

    function handleDrop(e) {
        e.preventDefault();
        this.classList.remove('drag-over');
        
        const id = e.dataTransfer.getData('text/plain');
        const act = activities.find(a => a.id === id);
        
        if (act) {
            // Create a copy of the card for the grid
            const newCard = createCardElement(act, true);
            this.appendChild(newCard);
            saveSchedule();
        }
    }

    function removeCard(btn, e) {
        e.stopPropagation(); // prevent modal opening
        if (!document.getElementById('adminToggle').checked) return;
        btn.parentElement.remove();
        saveSchedule();
    }

    // --- 4. MODAL LOGIC ---
    const modal = document.getElementById('modal');
    
    function showDetails(id) {
        const act = activities.find(a => a.id === id);
        if(!act) return;

        document.getElementById('m-title').innerText = act.title;
        const metaEl = document.getElementById('m-meta');
        metaEl.innerHTML = `<span style="background:${act.color}">${act.type}</span>`;
        
        document.getElementById('m-desc').innerText = act.desc;
        document.getElementById('m-title').style.color = act.color;
        
        modal.style.display = 'flex';
    }

    function closeModal() {
        modal.style.display = 'none';
    }

    modal.addEventListener('click', (e) => {
        if (e.target === modal) closeModal();
    });

    // --- 5. TABS & STORAGE ---
    
    function switchTab(tab) {
        currentTab = tab;
        
        // Update UI buttons
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(`btn-${tab}`).classList.add('active');
        
        // Reload Grid
        renderGrid();
    }

    function toggleMode() {
        const isAdmin = document.getElementById('adminToggle').checked;
        if (isAdmin) {
            document.body.classList.remove('read-only');
        } else {
            document.body.classList.add('read-only');
        }
    }

    function saveSchedule() {
        const schedule = [];
        const rows = document.querySelectorAll('.time-row');
        
        rows.forEach(row => {
            const zones = row.querySelectorAll('.drop-zone');
            zones.forEach(zone => {
                const cards = zone.querySelectorAll('.activity-card');
                cards.forEach(card => {
                    schedule.push({
                        time: zone.dataset.time,
                        zone: zone.dataset.zone,
                        actId: card.dataset.id
                    });
                });
            });
        });
        
        // Save with key specific to current tab
        localStorage.setItem(`vernatun_${currentTab}`, JSON.stringify(schedule));
    }

    function loadSchedule() {
        const saved = localStorage.getItem(`vernatun_${currentTab}`);
        if (!saved) return;
        
        const schedule = JSON.parse(saved);
        
        schedule.forEach(item => {
            // Find the zone
            const zoneEl = document.querySelector(`.drop-zone[data-time="${item.time}"][data-zone="${item.zone}"]`);
            // Find activity data
            const act = activities.find(a => a.id === item.actId);
            
            if (zoneEl && act) {
                const card = createCardElement(act, true);
                zoneEl.appendChild(card);
            }
        });
    }

    function clearSchedule() {
        if(!confirm(`–û—á–∏—Å—Ç–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –≤–∫–ª–∞–¥–∫–∏: ${currentTab === 'tue' ? '–í—Ç–æ—Ä–Ω–∏–∫' : '–°—É–±–±–æ—Ç–∞'}?`)) return;
        const zones = document.querySelectorAll('.drop-zone');
        zones.forEach(z => z.innerHTML = '');
        localStorage.removeItem(`vernatun_${currentTab}`);
    }

    // Init
    renderLibrary();
    renderGrid();

</script>

</body>
</html>